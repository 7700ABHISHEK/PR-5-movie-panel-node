<%- include('partials/start.ejs') %>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <div class="container-fluid">
        <div class="row justify-content-center my-5">
            <div class="col-12 col-md-10 col-lg-8 grid-margin stretch-card mt-3">
                <div class="card my-5">
                    <div class="card-body">

                        <h4 class="card-title">Edit Movie</h4>

                        <form id="editMovieForm" action="/admin/updateMovie/<%= movie.id %>" method="post"
                            class="forms-sample" enctype="multipart/form-data">

                            <div class="form-group mb-3">
                                <label for="movieName">Movie Name</label>
                                <input type="text" value="<%= movie.name %>" name="name" class="form-control text-white"
                                    id="movieName" placeholder="Enter movie title">
                            </div>

                            <div class="form-group mb-3">
                                <label for="genreSelect">Genre</label>
                                <select class="form-control text-white" name="genre" id="genreSelect">
                                    <option value="">Select Your Genre</option>
                                    <option <%=movie.genre=="devotional" ? "selected" : "" %>
                                        value="devotional">Devotional</option>
                                    <option <%=movie.genre=="action" ? "selected" : "" %> value="action">Action</option>
                                    <option <%=movie.genre=="comedy" ? "selected" : "" %> value="comedy">Comedy</option>
                                    <option <%=movie.genre=="drama" ? "selected" : "" %> value="drama">Drama</option>
                                    <option <%=movie.genre=="horror" ? "selected" : "" %> value="horror">Horror</option>
                                    <option <%=movie.genre=="sci" ? "selected" : "" %> value="sci">Sci-Fi</option>
                                    <option <%=movie.genre=="other" ? "selected" : "" %> value="other">Other</option>
                                </select>
                            </div>

                            <div class="form-group mb-3">
                                <label for="date">Release Date</label>
                                <input type="date" value="<%= movie.date %>" name="date" class="form-control text-white"
                                    id="releaseDate">
                            </div>

                            <div class="form-group mb-3">
                                <label for="ratingInput">Rating</label>
                                <select id="ratingInput" name="rating" class="form-control text-white">
                                    <option value="">Select your rating</option>
                                    <option <%=movie.rating=="1" ? "selected" : "" %> value="1">⭐</option>
                                    <option <%=movie.rating=="2" ? "selected" : "" %> value="2">⭐⭐</option>
                                    <option <%=movie.rating=="3" ? "selected" : "" %> value="3">⭐⭐⭐</option>
                                    <option <%=movie.rating=="4" ? "selected" : "" %> value="4">⭐⭐⭐⭐</option>
                                    <option <%=movie.rating=="5" ? "selected" : "" %> value="5">⭐⭐⭐⭐⭐</option>
                                </select>
                            </div>

                            <div class="form-group mb-3">
                                <label>Movie Poster</label>
                                <input type="file" name="photo" class="form-control text-white file-upload-info"
                                    placeholder="Upload Image" accept="image/*">
                                <img src="/<%= movie.photo %>" alt="<%= movie.name %>" width="100px" class="mt-2">
                            </div>

                            <div class="form-group mb-3">
                                <label for="descriptionTextarea">Description</label>
                                <textarea class="form-control text-white" name="description" id="descriptionTextarea"
                                    rows="4" placeholder="Write a short summary..."><%= movie.description %></textarea>
                            </div>

                            <button type="submit" class="btn btn-primary mr-2">Edit</button>

                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const form = document.getElementById('editMovieForm');

        form.addEventListener('submit', function (e) {
            e.preventDefault();

            const name = document.getElementById('movieName').value.trim();
            const genre = document.getElementById('genreSelect').value.trim();
            const date = document.getElementById('releaseDate').value.trim();
            const rating = document.getElementById('ratingInput').value.trim();
            const description = document.getElementById('descriptionTextarea').value.trim();

            if (!name) {
                Swal.fire({ icon: 'error', title: 'Movie Name Missing', text: 'Please enter the movie name', confirmButtonColor: '#3085d6' });
                return;
            }
            if (!genre) {
                Swal.fire({ icon: 'error', title: 'Genre Missing', text: 'Please select a genre', confirmButtonColor: '#3085d6' });
                return;
            }
            if (!date) {
                Swal.fire({ icon: 'error', title: 'Release Date Missing', text: 'Please select a release date', confirmButtonColor: '#3085d6' });
                return;
            }
            if (!rating) {
                Swal.fire({ icon: 'error', title: 'Rating Missing', text: 'Please select a rating', confirmButtonColor: '#3085d6' });
                return;
            }
            if (!description) {
                Swal.fire({ icon: 'error', title: 'Description Missing', text: 'Please enter a description', confirmButtonColor: '#3085d6' });
                return;
            }

            form.submit();
        });
    </script>

    <%- include('partials/end.ejs') %>